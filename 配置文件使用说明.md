# 配置文件版本使用说明

## 📋 概述

我为您创建了两个基于配置文件的自动化流程版本，您可以直接在文件内填写事件信息，无需命令行输入：

1. **`single_event_config.py`** - 单事件配置文件（推荐）
2. **`config_auto_pipeline.py`** - 多事件配置文件

## 🎯 推荐使用：单事件配置文件

### 使用方法

1. **打开文件**：编辑 `single_event_config.py`
2. **修改配置**：在文件开头找到配置区域，修改以下变量：

```python
# 事件名称
EVENT_NAME = "台积电获得英伟达AI芯片订单"

# 关键词实体列表
ENTITIES = ["台积电", "英伟达", "AI芯片", "半导体", "美国", "魏哲家"]

# 事件时间（可选，格式：YYYY-MM-DD）
EVENT_TIME = "2024-12-15"

# 运行模式：check / fit / init
MODE = "check"

# 时间跨度（天数）
TIMESPAN = "31"

# 是否需要处理中方关系反向化
PROCESS_CHINESE_RELATIONS = True

# 中方相关实体关键词（用于识别中方相关的关系）
CHINESE_ENTITIES = ["中国", "中方", "中华人民共和国", "北京", "政府", "外交部", "商务部", "发改委"]

# 正向关系词汇
POSITIVE_RELATIONS = ["增进", "感到满意", "相信", "认为优秀", "欢迎", "认为有成就", "支持", "认可", "欣赏", "视作英雄", "喜欢", "认为可靠", "感谢", "认为热情"]

# 负向关系词汇
NEGATIVE_RELATIONS = ["担忧", "损害", "质疑", "感到不满", "认为非法", "认为恐怖", "威胁", "攻击", "认为缺乏", "批评", "认为有威胁", "认为有危机", "认为有暴力", "认为犯罪", "认为违规", "认为失败"]
```

3. **运行脚本**：
```bash
python single_event_config.py
```

### 示例配置

#### 示例1：台积电相关事件
```python
EVENT_NAME = "台积电获得英伟达AI芯片订单"
ENTITIES = ["台积电", "英伟达", "AI芯片", "半导体", "美国", "魏哲家"]
EVENT_TIME = "2024-12-15"
MODE = "check"
TIMESPAN = "31"
```

#### 示例2：政治事件
```python
EVENT_NAME = "赖清德访问美国"
ENTITIES = ["赖清德", "美国", "台湾", "拜登", "中国"]
EVENT_TIME = "2024-11-20"
MODE = "check"
TIMESPAN = "31"
```

#### 示例3：经济事件
```python
EVENT_NAME = "台积电在德国建厂"
ENTITIES = ["台积电", "德国", "欧洲", "半导体", "魏哲家"]
EVENT_TIME = "2024-10-25"
MODE = "check"
TIMESPAN = "31"
```

## 🔧 多事件配置文件

如果您需要批量处理多个事件，可以使用 `config_auto_pipeline.py`：

### 配置方法

在文件中的 `EVENT_CONFIGS` 列表中添加多个事件：

```python
EVENT_CONFIGS = [
    {
        "event_name": "台积电获得英伟达AI芯片订单",
        "entities": ["台积电", "英伟达", "AI芯片", "半导体", "美国", "魏哲家"],
        "event_time": "2024-12-15",
        "mode": "check",
        "timespan": "31"
    },
    {
        "event_name": "赖清德访问美国",
        "entities": ["赖清德", "美国", "台湾", "拜登", "中国"],
        "event_time": "2024-11-20",
        "mode": "check",
        "timespan": "31"
    },
    # 可以继续添加更多事件...
]
```

### 测试模式

设置 `PROCESS_FIRST_ONLY = True` 可以只处理第一个事件进行测试：

```python
# 是否只处理第一个事件（用于测试）
PROCESS_FIRST_ONLY = True
```

## 📊 输出结果

运行完成后，您将得到：

1. **数据文件**: `tsmc_es_data/{事件名称}.csv`
2. **标签文件**: `tsmc_label.json`（包含新生成的标签）
3. **预测结果**: `tsmc_es_data/{事件名称}/output.json`
4. **可视化图表**: `tsmc_es_data/{事件名称}/output.png`

## 🔄 工作流程

```
修改配置文件中的事件信息
        ↓
运行配置文件脚本
        ↓
自动更新getGraphformEs.py配置
        ↓
运行ES查询获取数据
        ↓
保存数据到tsmc_es_data/
        ↓
处理中方关系反向化（可选）
        ↓
生成两两组合标签
        ↓
更新tsmc_label.json文件
        ↓
运行预测模型
        ↓
生成结果图表
        ↓
完成！
```

## 💡 使用建议

### 1. 单事件处理
- 使用 `single_event_config.py`
- 每次只处理一个事件
- 适合快速测试和单次分析

### 2. 批量处理
- 使用 `config_auto_pipeline.py`
- 可以配置多个事件
- 适合批量分析

### 3. 测试模式
- 设置 `PROCESS_FIRST_ONLY = True`
- 只处理第一个事件
- 适合验证配置是否正确

### 4. 中方关系反向化
- 设置 `PROCESS_CHINESE_RELATIONS = True` 启用功能
- 自动识别中方相关实体并反向化关系
- 生成新的处理后的CSV文件用于预测

### 5. 智能配置更新
- 使用正则表达式智能更新ES配置文件
- 无论当前配置是什么，都能正确替换
- 支持多次运行，不会因为配置已修改而失效

## ⚠️ 注意事项

1. **事件名称**：使用中文，避免特殊字符
2. **关键词实体**：至少需要2个实体
3. **时间格式**：使用 YYYY-MM-DD 格式
4. **运行模式**：
   - `check`：检查模式（默认）
   - `fit`：拟合模式
   - `init`：初始化模式
5. **中方关系反向化**：
   - 自动识别包含中方关键词的实体
   - 将正向关系随机替换为负向关系，负向关系随机替换为正向关系
   - 使用丰富的关系词汇库（14个正向词汇，16个负向词汇）
   - 生成新的处理后的CSV文件：`{事件名称}_processed.csv`

6. **智能配置更新**：
   - 使用正则表达式智能更新ES配置文件
   - 无论当前配置是什么，都能正确替换
   - 支持多次运行，不会因为配置已修改而失效

## 🛠️ 故障排除

### 常见问题

1. **配置错误**
   - 检查事件名称和关键词是否正确
   - 确保时间格式为 YYYY-MM-DD

2. **ES连接失败**
   - 检查ES服务是否运行
   - 检查网络连接

3. **数据文件未生成**
   - 检查ES查询条件
   - 检查关键词是否匹配

4. **模型运行失败**
   - 检查依赖包是否安装
   - 检查数据格式是否正确

## 🎉 优势

相比命令行版本，配置文件版本具有以下优势：

1. **简单易用**：只需修改几个变量
2. **可重复使用**：配置保存后可以重复运行
3. **批量处理**：支持多个事件配置
4. **测试友好**：支持测试模式
5. **版本控制**：配置文件可以纳入版本控制

现在您可以直接在文件中填写事件信息，然后运行脚本即可完成整个自动化流程！ 