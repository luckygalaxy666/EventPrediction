# 中方关系反向化功能说明

## 🎯 功能概述

中方关系反向化功能可以自动识别CSV数据中的中方相关实体，并将其关系倾向进行反向处理，用于生成新的数据集进行预测分析。

## 🔧 功能特点

### 1. 自动识别中方实体
系统会使用正则匹配识别**头实体**中包含以下关键词的实体：
- `中国`
- `中方`
- `中华人民共和国`
- `北京`
- `政府`
- `外交部`
- `商务部`
- `发改委`

**重要**：只有当头实体（source_entity）包含中方相关关键词时才会进行处理，尾实体包含不会触发处理。

### 2. 关系反向化处理
- **正向 → 负向**：将中方相关的正向关系随机替换为负向关系
- **负向 → 正向**：将中方相关的负向关系随机替换为正向关系
- **其他关系**：保持不变

### 3. 丰富的关系词汇库
**正向关系词汇（14个）**：
- 增进、感到满意、相信、认为优秀、欢迎、认为有成就
- 支持、认可、欣赏、视作英雄、喜欢、认为可靠、感谢、认为热情

**负向关系词汇（16个）**：
- 担忧、损害、质疑、感到不满、认为非法、认为恐怖、威胁、攻击
- 认为缺乏、批评、认为有威胁、认为有危机、认为有暴力、认为犯罪、认为违规、认为失败

### 4. 选择性处理
- 只处理**头实体**包含中方相关关键词的关系
- 尾实体包含中方关键词的关系保持原样
- 非中方相关的关系保持原样
- 生成新的CSV文件，不覆盖原始数据

## 📋 配置参数

在 `single_event_config.py` 中可以配置以下参数：

```python
# 是否需要处理中方关系反向化
PROCESS_CHINESE_RELATIONS = True

# 中方相关实体关键词（用于识别中方相关的关系）
CHINESE_ENTITIES = ["中国", "中方", "中华人民共和国", "北京", "政府", "外交部", "商务部", "发改委"]

# 正向关系词汇
POSITIVE_RELATIONS = ["增进", "感到满意", "相信", "认为优秀", "欢迎", "认为有成就", "支持", "认可", "欣赏", "视作英雄", "喜欢", "认为可靠", "感谢", "认为热情"]

# 负向关系词汇
NEGATIVE_RELATIONS = ["担忧", "损害", "质疑", "感到不满", "认为非法", "认为恐怖", "威胁", "攻击", "认为缺乏", "批评", "认为有威胁", "认为有危机", "认为有暴力", "认为犯罪", "认为违规", "认为失败"]
```

## 🔄 处理流程

```
原始CSV文件
    ↓
读取每一行数据
    ↓
检查头实体是否包含中方关键词（正则匹配）
    ↓
是 → 反向化关系
否 → 保持原样
    ↓
写入新的CSV文件
    ↓
使用新文件进行预测
```

## 📊 处理示例

### 原始数据
```
台积电,Company,支持,英伟达,Company,2024-12-15
中国,Country,增进,美国,Country,2024-12-15
美国,Country,威胁,中国,Country,2024-12-15
中方,Government,欢迎,台湾,Region,2024-12-15
台积电,Company,担忧,中国,Country,2024-12-15
```

### 处理后数据（只处理头实体包含中方关键词的关系）
```
台积电,Company,支持,英伟达,Company,2024-12-15
中国,Country,威胁,美国,Country,2024-12-15  ← 头实体"中国"，处理
美国,Country,威胁,中国,Country,2024-12-15  ← 头实体"美国"，不处理
中方,Government,批评,台湾,Region,2024-12-15  ← 头实体"中方"，处理
台积电,Company,担忧,中国,Country,2024-12-15  ← 头实体"台积电"，不处理
```

## 📁 输出文件

- **原始文件**：`tsmc_es_data/{事件名称}.csv`
- **处理后文件**：`tsmc_es_data/{事件名称}_processed.csv`
- **预测使用**：处理后文件（如果启用了反向化功能）

## 🧪 测试功能

运行测试脚本验证功能：

```bash
python test_enhanced_chinese_relations.py
```

测试脚本会：
1. 创建包含中方关系的测试数据
2. 执行反向化处理
3. 显示处理前后的对比
4. 清理测试文件

## 💡 使用场景

### 1. 政治关系分析
- 分析中方与其他国家/地区的关系变化
- 研究政策倾向的转变

### 2. 经济影响评估
- 评估中方政策对经济实体的影响
- 分析贸易关系的动态变化

### 3. 舆情分析
- 研究媒体报道的倾向性
- 分析公众对中方相关事件的态度

## ⚠️ 注意事项

1. **实体识别**：基于正则匹配，只检查头实体是否包含中方相关关键词
2. **处理范围**：只有当头实体包含中方关键词时才处理，尾实体包含不会触发处理
3. **关系类型**：支持30种丰富的关系词汇（14个正向，16个负向）
4. **随机替换**：正向关系随机替换为负向关系，负向关系随机替换为正向关系
5. **数据备份**：原始数据不会被修改，会生成新的处理文件
6. **处理统计**：会显示处理记录数和处理比例

## 🔧 自定义配置

### 添加新的中方实体关键词
```python
CHINESE_ENTITIES = [
    "中国", "中方", "中华人民共和国", "北京", "政府", 
    "外交部", "商务部", "发改委", "国务院", "中央"
]
```

### 自定义关系词汇
```python
# 添加新的正向关系词汇
POSITIVE_RELATIONS = ["增进", "感到满意", "相信", "认为优秀", "欢迎", "认为有成就", "支持", "认可", "欣赏", "视作英雄", "喜欢", "认为可靠", "感谢", "认为热情", "新正向词汇"]

# 添加新的负向关系词汇
NEGATIVE_RELATIONS = ["担忧", "损害", "质疑", "感到不满", "认为非法", "认为恐怖", "威胁", "攻击", "认为缺乏", "批评", "认为有威胁", "认为有危机", "认为有暴力", "认为犯罪", "认为违规", "认为失败", "新负向词汇"]
```

### 禁用反向化功能
```python
PROCESS_CHINESE_RELATIONS = False
```

## 📈 处理统计

系统会显示详细的处理统计信息：
- 总记录数
- 处理记录数
- 处理比例
- 具体处理的关系示例

## 🎉 优势

1. **自动化处理**：无需手动修改数据
2. **精确识别**：基于关键词的智能识别
3. **数据安全**：不覆盖原始数据
4. **灵活配置**：可自定义中方实体关键词
5. **详细统计**：提供完整的处理报告

这个功能可以帮助您快速生成中方关系反向化的数据集，用于更全面的预测分析！ 